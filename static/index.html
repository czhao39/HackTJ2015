<!doctype html>
<html>
	<head>
		<title>Map</title>
		<link href="/css/bootstrap.css" rel="stylesheet" type="text/css" />
		<script src="/js/jquery.js"></script>
		<script src="/js/bootstrap.js"></script>
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:700,300,400" rel="stylesheet" type="text/css">
        <link href="/css/main.css" rel="stylesheet" type="text/css"/>
        <link rel="shortcut icon" href="favicon.ico"/>
		<script>
        var root;
        var code_to_state = { "AL": "Alabama", "AK": "Alaska", "AZ": "Arizona", "AR": "Arkansas", "CA": "California", "CO": "Colorado", "CT": "Connecticut", "DE": "Delaware", "DC": "District Of Columbia", "FL": "Florida", "GA": "Georgia", "HI": "Hawaii", "ID": "Idaho", "IL": "Illinois", "IN": "Indiana", "IA": "Iowa", "KS": "Kansas", "KY": "Kentucky", "LA": "Louisiana", "ME": "Maine", "MD": "Maryland", "MA": "Massachusetts", "MI": "Michigan", "MN": "Minnesota", "MS": "Mississippi", "MO": "Missouri", "MT": "Montana", "NE": "Nebraska", "NV": "Nevada", "NH": "New Hampshire", "NJ": "New Jersey", "NM": "New Mexico", "NY": "New York", "NC": "North Carolina", "ND": "North Dakota", "OH": "Ohio", "OK": "Oklahoma", "OR": "Oregon", "PA": "Pennsylvania", "RI": "Rhode Island", "SC": "South Carolina", "SD": "South Dakota", "TN": "Tennessee", "TX": "Texas", "UT": "Utah", "VT": "Vermont", "VA": "Virginia", "WA": "Washington", "WV": "West Virginia", "WI": "Wisconsin", "WY": "Wyoming" };
		$(document).ready(function() {
            svg = document.getElementById('map');
            svg.addEventListener("load", function() {
                svg = svg.contentDocument;
                root = svg.getElementsByTagName('svg')[0];
                paths = root.getElementsByTagName('path');
			    for (i = 0; i < paths.length; i++) {
				    var pn = paths[i].id;
				    var elm = svg.getElementById(pn);
                    if (elm != null) {
                        elm.addEventListener("click", function() {
                            var sid = this.id;
                            if (sid == "MI-" || sid == "SP-") {
                                sid = "MI";
                            }
                            $.getJSON("/state?s=" + encodeURIComponent(sid), function(data) {
                                console.log(data);
                            });
                        });
                    }
			    }
            });
            var mx = 0;
            var my = 0;
            $(document).mousemove(function(e) {
                mx = e.pageX;
                my = e.pageY;
                $("#img-overlay").css({'top':my+20, 'left':mx+20});
            });
            $("button[data-over]").mouseover(function(e) {
                $("#img-overlay img").attr("src", "/img/pic/" + $(this).attr("data-over"));
                var ct = $(this).hasClass("dem");
                $("#img-overlay img").css("border-color", ct ? "#717ECD" : "#CF5C60");
                $("#img-overlay").show();
            }).mouseout(function() {
                $("#img-overlay").hide();
            });
            $("#dem button, #rep button").click(function(e) {
                e.preventDefault();
                $("#state-table-body").empty();
                var ct = $(this).hasClass("dem") ? "rgba(0,0,255," : "rgba(255,0,0,";
                $.getJSON("/nation?p=" + encodeURIComponent($(this).text()), function(data) {
                    for (var key in data) {
                        pos = data[key][0];
                        neg = data[key][1];
                        total = pos + neg;
                        ppos = (pos / total * 100).toFixed(2);
                        pneg = (neg / total * 100).toFixed(2);
                        $("#state-table-body").append("<tr><td>" + code_to_state[key] + "</td><td>" + pos + " tweets</td><td>" + ppos + "%</td><td>" + neg + " tweets</td><td>" + pneg + "%</td></tr>");
                        // hardcoded michigan because separation
                        var clr = ct;
                        if (key == "MI") {
                            key = "MI-";
                            data["MI-"] = clr;
                            svg.getElementById("SP-").style.fill = ct+pos/total+")";
                        }
                        var elm = svg.getElementById(key);
                        elm.style.fill = ct+pos/total+")";
                    }
                });
            });
		});
		</script>
	</head>
	<body>
    <div id="img-overlay"><img /></div>
        <nav id="topbar" class="navbar navbar-static-top" role="navigation">
            <div class="container">
                <a class="btn" href="/">
                    <img src="img/twoll.png" id="logo" /> twoll
                </a>
            </div>
        </nav>
        <div id="input" class="row">
            <div class="col-md-6">
                <div id="dem">
                    <button id="dembut" type="button" class="btn btn-default dem">Democrat</button>
                    <div class="row">
                        <div class=col-md-12">
                            <button type="button" class="btn btn-default dem" data-over="biden.jpg">Joe Biden</button>
                            <button type="button" class="btn btn-default dem" data-over="clinton.jpg">Hillary Clinton</button>
                            <button type="button" class="btn btn-default dem" data-over="omalley.jpg">Martin O'Malley</button>
                            <button type="button" class="btn btn-default dem" data-over="sanders.jpg">Bernie Sanders</button>
                            <button type="button" class="btn btn-default dem" data-over="warren.jpg">Elizabeth Warren</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div id="rep">
                    <button id="repbut" type="button" class="btn btn-default rep">Republican</button>
                    <div class="row">
                        <div class="col-md-6">
                            <button type="button" class="btn btn-default rep" data-over="bush.jpg">Jeb Bush</button>
                            <button type="button" class="btn btn-default rep" data-over="christie.jpg">Chris Christie</button>
                            <button type="button" class="btn btn-default rep" data-over="huckabee.jpg">Mike Huckabee</button>
                            <button type="button" class="btn btn-default rep" data-over="perry.jpg">Rick Perry</button>
                            <button type="button" class="btn btn-default rep" data-over="santorum.jpg">Rick Santorum</button>
                        </div>
                        <div class="col-md-6">
                            <button type="button" class="btn btn-default rep" data-over="carson.jpg">Dr. Ben Carson</button>
                            <button type="button" class="btn btn-default rep" data-over="cruz.jpg">Ted Cruz</button>
                            <button type="button" class="btn btn-default rep" data-over="paul.jpg">Rand Paul</button>
                            <button type="button" class="btn btn-default rep" data-over="rubio.jpg">Marco Rubio</button>
                            <button type="button" class="btn btn-default rep" data-over="walker.jpg">Scott Walker</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
		<div id="container">
			<object id="map" type="text/svg+xml" data="/img/map.svg"></object>
		</div>
        <div id="state-table">
            <table class="table">
                <thead><th>State</th><th>Positive Total</th><th>Positive %</th><th>Negative Total</th><th>Negative %</th></thead>
                <tbody id="state-table-body"><tr><td rowspan="5">Select a candidate to view state data.</td></tr></tbody>
            </table>
        </div>
	</body>
</html>
